{"ast":null,"code":"/*!\r\n * send\r\n * Copyright(c) 2012 TJ Holowaychuk\r\n * Copyright(c) 2014-2016 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\n\n'use strict';\n\n/**\r\n * Module dependencies.\r\n * @private\r\n */\nvar createError = require('http-errors');\nvar debug = require('debug')('send');\nvar deprecate = require('depd')('send');\nvar destroy = require('destroy');\nvar encodeUrl = require('encodeurl');\nvar escapeHtml = require('escape-html');\nvar etag = require('etag');\nvar fresh = require('fresh');\nvar fs = require('fs');\nvar mime = require('mime');\nvar ms = require('ms');\nvar onFinished = require('on-finished');\nvar parseRange = require('range-parser');\nvar path = require('path');\nvar statuses = require('statuses');\nvar Stream = require('stream');\nvar util = require('util');\n\n/**\r\n * Path function references.\r\n * @private\r\n */\n\nvar extname = path.extname;\nvar join = path.join;\nvar normalize = path.normalize;\nvar resolve = path.resolve;\nvar sep = path.sep;\n\n/**\r\n * Regular expression for identifying a bytes Range header.\r\n * @private\r\n */\n\nvar BYTES_RANGE_REGEXP = /^ *bytes=/;\n\n/**\r\n * Maximum value allowed for the max age.\r\n * @private\r\n */\n\nvar MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000; // 1 year\n\n/**\r\n * Regular expression to match a path with a directory up component.\r\n * @private\r\n */\n\nvar UP_PATH_REGEXP = /(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/;\n\n/**\r\n * Module exports.\r\n * @public\r\n */\n\nmodule.exports = send;\nmodule.exports.mime = mime;\n\n/**\r\n * Return a `SendStream` for `req` and `path`.\r\n *\r\n * @param {object} req\r\n * @param {string} path\r\n * @param {object} [options]\r\n * @return {SendStream}\r\n * @public\r\n */\n\nfunction send(req, path, options) {\n  return new SendStream(req, path, options);\n}\n\n/**\r\n * Initialize a `SendStream` with the given `path`.\r\n *\r\n * @param {Request} req\r\n * @param {String} path\r\n * @param {object} [options]\r\n * @private\r\n */\n\nfunction SendStream(req, path, options) {\n  Stream.call(this);\n  var opts = options || {};\n  this.options = opts;\n  this.path = path;\n  this.req = req;\n  this._acceptRanges = opts.acceptRanges !== undefined ? Boolean(opts.acceptRanges) : true;\n  this._cacheControl = opts.cacheControl !== undefined ? Boolean(opts.cacheControl) : true;\n  this._etag = opts.etag !== undefined ? Boolean(opts.etag) : true;\n  this._dotfiles = opts.dotfiles !== undefined ? opts.dotfiles : 'ignore';\n  if (this._dotfiles !== 'ignore' && this._dotfiles !== 'allow' && this._dotfiles !== 'deny') {\n    throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"');\n  }\n  this._hidden = Boolean(opts.hidden);\n  if (opts.hidden !== undefined) {\n    deprecate('hidden: use dotfiles: \\'' + (this._hidden ? 'allow' : 'ignore') + '\\' instead');\n  }\n\n  // legacy support\n  if (opts.dotfiles === undefined) {\n    this._dotfiles = undefined;\n  }\n  this._extensions = opts.extensions !== undefined ? normalizeList(opts.extensions, 'extensions option') : [];\n  this._immutable = opts.immutable !== undefined ? Boolean(opts.immutable) : false;\n  this._index = opts.index !== undefined ? normalizeList(opts.index, 'index option') : ['index.html'];\n  this._lastModified = opts.lastModified !== undefined ? Boolean(opts.lastModified) : true;\n  this._maxage = opts.maxAge || opts.maxage;\n  this._maxage = typeof this._maxage === 'string' ? ms(this._maxage) : Number(this._maxage);\n  this._maxage = !isNaN(this._maxage) ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE) : 0;\n  this._root = opts.root ? resolve(opts.root) : null;\n  if (!this._root && opts.from) {\n    this.from(opts.from);\n  }\n}\n\n/**\r\n * Inherits from `Stream`.\r\n */\n\nutil.inherits(SendStream, Stream);\n\n/**\r\n * Enable or disable etag generation.\r\n *\r\n * @param {Boolean} val\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.etag = deprecate.function(function etag(val) {\n  this._etag = Boolean(val);\n  debug('etag %s', this._etag);\n  return this;\n}, 'send.etag: pass etag as option');\n\n/**\r\n * Enable or disable \"hidden\" (dot) files.\r\n *\r\n * @param {Boolean} path\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.hidden = deprecate.function(function hidden(val) {\n  this._hidden = Boolean(val);\n  this._dotfiles = undefined;\n  debug('hidden %s', this._hidden);\n  return this;\n}, 'send.hidden: use dotfiles option');\n\n/**\r\n * Set index `paths`, set to a falsy\r\n * value to disable index support.\r\n *\r\n * @param {String|Boolean|Array} paths\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.index = deprecate.function(function index(paths) {\n  var index = !paths ? [] : normalizeList(paths, 'paths argument');\n  debug('index %o', paths);\n  this._index = index;\n  return this;\n}, 'send.index: pass index as option');\n\n/**\r\n * Set root `path`.\r\n *\r\n * @param {String} path\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.root = function root(path) {\n  this._root = resolve(String(path));\n  debug('root %s', this._root);\n  return this;\n};\nSendStream.prototype.from = deprecate.function(SendStream.prototype.root, 'send.from: pass root as option');\nSendStream.prototype.root = deprecate.function(SendStream.prototype.root, 'send.root: pass root as option');\n\n/**\r\n * Set max-age to `maxAge`.\r\n *\r\n * @param {Number} maxAge\r\n * @return {SendStream}\r\n * @api public\r\n */\n\nSendStream.prototype.maxage = deprecate.function(function maxage(maxAge) {\n  this._maxage = typeof maxAge === 'string' ? ms(maxAge) : Number(maxAge);\n  this._maxage = !isNaN(this._maxage) ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE) : 0;\n  debug('max-age %d', this._maxage);\n  return this;\n}, 'send.maxage: pass maxAge as option');\n\n/**\r\n * Emit error with `status`.\r\n *\r\n * @param {number} status\r\n * @param {Error} [err]\r\n * @private\r\n */\n\nSendStream.prototype.error = function error(status, err) {\n  // emit if listeners instead of responding\n  if (hasListeners(this, 'error')) {\n    return this.emit('error', createError(status, err, {\n      expose: false\n    }));\n  }\n  var res = this.res;\n  var msg = statuses[status] || String(status);\n  var doc = createHtmlDocument('Error', escapeHtml(msg));\n\n  // clear existing headers\n  clearHeaders(res);\n\n  // add error headers\n  if (err && err.headers) {\n    setHeaders(res, err.headers);\n  }\n\n  // send basic response\n  res.statusCode = status;\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n  res.setHeader('Content-Length', Buffer.byteLength(doc));\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\");\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.end(doc);\n};\n\n/**\r\n * Check if the pathname ends with \"/\".\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\n\nSendStream.prototype.hasTrailingSlash = function hasTrailingSlash() {\n  return this.path[this.path.length - 1] === '/';\n};\n\n/**\r\n * Check if this is a conditional GET request.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\nSendStream.prototype.isConditionalGET = function isConditionalGET() {\n  return this.req.headers['if-match'] || this.req.headers['if-unmodified-since'] || this.req.headers['if-none-match'] || this.req.headers['if-modified-since'];\n};\n\n/**\r\n * Check if the request preconditions failed.\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\n\nSendStream.prototype.isPreconditionFailure = function isPreconditionFailure() {\n  var req = this.req;\n  var res = this.res;\n\n  // if-match\n  var match = req.headers['if-match'];\n  if (match) {\n    var etag = res.getHeader('ETag');\n    return !etag || match !== '*' && parseTokenList(match).every(function (match) {\n      return match !== etag && match !== 'W/' + etag && 'W/' + match !== etag;\n    });\n  }\n\n  // if-unmodified-since\n  var unmodifiedSince = parseHttpDate(req.headers['if-unmodified-since']);\n  if (!isNaN(unmodifiedSince)) {\n    var lastModified = parseHttpDate(res.getHeader('Last-Modified'));\n    return isNaN(lastModified) || lastModified > unmodifiedSince;\n  }\n  return false;\n};\n\n/**\r\n * Strip content-* header fields.\r\n *\r\n * @private\r\n */\n\nSendStream.prototype.removeContentHeaderFields = function removeContentHeaderFields() {\n  var res = this.res;\n  var headers = getHeaderNames(res);\n  for (var i = 0; i < headers.length; i++) {\n    var header = headers[i];\n    if (header.substr(0, 8) === 'content-' && header !== 'content-location') {\n      res.removeHeader(header);\n    }\n  }\n};\n\n/**\r\n * Respond with 304 not modified.\r\n *\r\n * @api private\r\n */\n\nSendStream.prototype.notModified = function notModified() {\n  var res = this.res;\n  debug('not modified');\n  this.removeContentHeaderFields();\n  res.statusCode = 304;\n  res.end();\n};\n\n/**\r\n * Raise error that headers already sent.\r\n *\r\n * @api private\r\n */\n\nSendStream.prototype.headersAlreadySent = function headersAlreadySent() {\n  var err = new Error('Can\\'t set headers after they are sent.');\n  debug('headers already sent');\n  this.error(500, err);\n};\n\n/**\r\n * Check if the request is cacheable, aka\r\n * responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\nSendStream.prototype.isCachable = function isCachable() {\n  var statusCode = this.res.statusCode;\n  return statusCode >= 200 && statusCode < 300 || statusCode === 304;\n};\n\n/**\r\n * Handle stat() error.\r\n *\r\n * @param {Error} error\r\n * @private\r\n */\n\nSendStream.prototype.onStatError = function onStatError(error) {\n  switch (error.code) {\n    case 'ENAMETOOLONG':\n    case 'ENOENT':\n    case 'ENOTDIR':\n      this.error(404, error);\n      break;\n    default:\n      this.error(500, error);\n      break;\n  }\n};\n\n/**\r\n * Check if the cache is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\nSendStream.prototype.isFresh = function isFresh() {\n  return fresh(this.req.headers, {\n    'etag': this.res.getHeader('ETag'),\n    'last-modified': this.res.getHeader('Last-Modified')\n  });\n};\n\n/**\r\n * Check if the range is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\n\nSendStream.prototype.isRangeFresh = function isRangeFresh() {\n  var ifRange = this.req.headers['if-range'];\n  if (!ifRange) {\n    return true;\n  }\n\n  // if-range as etag\n  if (ifRange.indexOf('\"') !== -1) {\n    var etag = this.res.getHeader('ETag');\n    return Boolean(etag && ifRange.indexOf(etag) !== -1);\n  }\n\n  // if-range as modified date\n  var lastModified = this.res.getHeader('Last-Modified');\n  return parseHttpDate(lastModified) <= parseHttpDate(ifRange);\n};\n\n/**\r\n * Redirect to path.\r\n *\r\n * @param {string} path\r\n * @private\r\n */\n\nSendStream.prototype.redirect = function redirect(path) {\n  var res = this.res;\n  if (hasListeners(this, 'directory')) {\n    this.emit('directory', res, path);\n    return;\n  }\n  if (this.hasTrailingSlash()) {\n    this.error(403);\n    return;\n  }\n  var loc = encodeUrl(collapseLeadingSlashes(this.path + '/'));\n  var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' + escapeHtml(loc) + '</a>');\n\n  // redirect\n  res.statusCode = 301;\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n  res.setHeader('Content-Length', Buffer.byteLength(doc));\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\");\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.setHeader('Location', loc);\n  res.end(doc);\n};\n\n/**\r\n * Pipe to `res.\r\n *\r\n * @param {Stream} res\r\n * @return {Stream} res\r\n * @api public\r\n */\n\nSendStream.prototype.pipe = function pipe(res) {\n  // root path\n  var root = this._root;\n\n  // references\n  this.res = res;\n\n  // decode the path\n  var path = decode(this.path);\n  if (path === -1) {\n    this.error(400);\n    return res;\n  }\n\n  // null byte(s)\n  if (~path.indexOf('\\0')) {\n    this.error(400);\n    return res;\n  }\n  var parts;\n  if (root !== null) {\n    // normalize\n    if (path) {\n      path = normalize('.' + sep + path);\n    }\n\n    // malicious path\n    if (UP_PATH_REGEXP.test(path)) {\n      debug('malicious path \"%s\"', path);\n      this.error(403);\n      return res;\n    }\n\n    // explode path parts\n    parts = path.split(sep);\n\n    // join / normalize from optional root dir\n    path = normalize(join(root, path));\n  } else {\n    // \"..\" is malicious without \"root\"\n    if (UP_PATH_REGEXP.test(path)) {\n      debug('malicious path \"%s\"', path);\n      this.error(403);\n      return res;\n    }\n\n    // explode path parts\n    parts = normalize(path).split(sep);\n\n    // resolve the path\n    path = resolve(path);\n  }\n\n  // dotfile handling\n  if (containsDotFile(parts)) {\n    var access = this._dotfiles;\n\n    // legacy support\n    if (access === undefined) {\n      access = parts[parts.length - 1][0] === '.' ? this._hidden ? 'allow' : 'ignore' : 'allow';\n    }\n    debug('%s dotfile \"%s\"', access, path);\n    switch (access) {\n      case 'allow':\n        break;\n      case 'deny':\n        this.error(403);\n        return res;\n      case 'ignore':\n      default:\n        this.error(404);\n        return res;\n    }\n  }\n\n  // index file support\n  if (this._index.length && this.hasTrailingSlash()) {\n    this.sendIndex(path);\n    return res;\n  }\n  this.sendFile(path);\n  return res;\n};\n\n/**\r\n * Transfer `path`.\r\n *\r\n * @param {String} path\r\n * @api public\r\n */\n\nSendStream.prototype.send = function send(path, stat) {\n  var len = stat.size;\n  var options = this.options;\n  var opts = {};\n  var res = this.res;\n  var req = this.req;\n  var ranges = req.headers.range;\n  var offset = options.start || 0;\n  if (headersSent(res)) {\n    // impossible to send now\n    this.headersAlreadySent();\n    return;\n  }\n  debug('pipe \"%s\"', path);\n\n  // set header fields\n  this.setHeader(path, stat);\n\n  // set content-type\n  this.type(path);\n\n  // conditional GET support\n  if (this.isConditionalGET()) {\n    if (this.isPreconditionFailure()) {\n      this.error(412);\n      return;\n    }\n    if (this.isCachable() && this.isFresh()) {\n      this.notModified();\n      return;\n    }\n  }\n\n  // adjust len to start/end options\n  len = Math.max(0, len - offset);\n  if (options.end !== undefined) {\n    var bytes = options.end - offset + 1;\n    if (len > bytes) len = bytes;\n  }\n\n  // Range support\n  if (this._acceptRanges && BYTES_RANGE_REGEXP.test(ranges)) {\n    // parse\n    ranges = parseRange(len, ranges, {\n      combine: true\n    });\n\n    // If-Range support\n    if (!this.isRangeFresh()) {\n      debug('range stale');\n      ranges = -2;\n    }\n\n    // unsatisfiable\n    if (ranges === -1) {\n      debug('range unsatisfiable');\n\n      // Content-Range\n      res.setHeader('Content-Range', contentRange('bytes', len));\n\n      // 416 Requested Range Not Satisfiable\n      return this.error(416, {\n        headers: {\n          'Content-Range': res.getHeader('Content-Range')\n        }\n      });\n    }\n\n    // valid (syntactically invalid/multiple ranges are treated as a regular response)\n    if (ranges !== -2 && ranges.length === 1) {\n      debug('range %j', ranges);\n\n      // Content-Range\n      res.statusCode = 206;\n      res.setHeader('Content-Range', contentRange('bytes', len, ranges[0]));\n\n      // adjust for requested range\n      offset += ranges[0].start;\n      len = ranges[0].end - ranges[0].start + 1;\n    }\n  }\n\n  // clone options\n  for (var prop in options) {\n    opts[prop] = options[prop];\n  }\n\n  // set read options\n  opts.start = offset;\n  opts.end = Math.max(offset, offset + len - 1);\n\n  // content-length\n  res.setHeader('Content-Length', len);\n\n  // HEAD support\n  if (req.method === 'HEAD') {\n    res.end();\n    return;\n  }\n  this.stream(path, opts);\n};\n\n/**\r\n * Transfer file for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\nSendStream.prototype.sendFile = function sendFile(path) {\n  var i = 0;\n  var self = this;\n  debug('stat \"%s\"', path);\n  fs.stat(path, function onstat(err, stat) {\n    if (err && err.code === 'ENOENT' && !extname(path) && path[path.length - 1] !== sep) {\n      // not found, check extensions\n      return next(err);\n    }\n    if (err) return self.onStatError(err);\n    if (stat.isDirectory()) return self.redirect(path);\n    self.emit('file', path, stat);\n    self.send(path, stat);\n  });\n  function next(err) {\n    if (self._extensions.length <= i) {\n      return err ? self.onStatError(err) : self.error(404);\n    }\n    var p = path + '.' + self._extensions[i++];\n    debug('stat \"%s\"', p);\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err);\n      if (stat.isDirectory()) return next();\n      self.emit('file', p, stat);\n      self.send(p, stat);\n    });\n  }\n};\n\n/**\r\n * Transfer index for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\nSendStream.prototype.sendIndex = function sendIndex(path) {\n  var i = -1;\n  var self = this;\n  function next(err) {\n    if (++i >= self._index.length) {\n      if (err) return self.onStatError(err);\n      return self.error(404);\n    }\n    var p = join(path, self._index[i]);\n    debug('stat \"%s\"', p);\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err);\n      if (stat.isDirectory()) return next();\n      self.emit('file', p, stat);\n      self.send(p, stat);\n    });\n  }\n  next();\n};\n\n/**\r\n * Stream `path` to the response.\r\n *\r\n * @param {String} path\r\n * @param {Object} options\r\n * @api private\r\n */\n\nSendStream.prototype.stream = function stream(path, options) {\n  // TODO: this is all lame, refactor meeee\n  var finished = false;\n  var self = this;\n  var res = this.res;\n\n  // pipe\n  var stream = fs.createReadStream(path, options);\n  this.emit('stream', stream);\n  stream.pipe(res);\n\n  // response finished, done with the fd\n  onFinished(res, function onfinished() {\n    finished = true;\n    destroy(stream);\n  });\n\n  // error handling code-smell\n  stream.on('error', function onerror(err) {\n    // request already finished\n    if (finished) return;\n\n    // clean up stream\n    finished = true;\n    destroy(stream);\n\n    // error\n    self.onStatError(err);\n  });\n\n  // end\n  stream.on('end', function onend() {\n    self.emit('end');\n  });\n};\n\n/**\r\n * Set content-type based on `path`\r\n * if it hasn't been explicitly set.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\nSendStream.prototype.type = function type(path) {\n  var res = this.res;\n  if (res.getHeader('Content-Type')) return;\n  var type = mime.lookup(path);\n  if (!type) {\n    debug('no content-type');\n    return;\n  }\n  var charset = mime.charsets.lookup(type);\n  debug('content-type %s', type);\n  res.setHeader('Content-Type', type + (charset ? '; charset=' + charset : ''));\n};\n\n/**\r\n * Set response header fields, most\r\n * fields may be pre-defined.\r\n *\r\n * @param {String} path\r\n * @param {Object} stat\r\n * @api private\r\n */\n\nSendStream.prototype.setHeader = function setHeader(path, stat) {\n  var res = this.res;\n  this.emit('headers', res, path, stat);\n  if (this._acceptRanges && !res.getHeader('Accept-Ranges')) {\n    debug('accept ranges');\n    res.setHeader('Accept-Ranges', 'bytes');\n  }\n  if (this._cacheControl && !res.getHeader('Cache-Control')) {\n    var cacheControl = 'public, max-age=' + Math.floor(this._maxage / 1000);\n    if (this._immutable) {\n      cacheControl += ', immutable';\n    }\n    debug('cache-control %s', cacheControl);\n    res.setHeader('Cache-Control', cacheControl);\n  }\n  if (this._lastModified && !res.getHeader('Last-Modified')) {\n    var modified = stat.mtime.toUTCString();\n    debug('modified %s', modified);\n    res.setHeader('Last-Modified', modified);\n  }\n  if (this._etag && !res.getHeader('ETag')) {\n    var val = etag(stat);\n    debug('etag %s', val);\n    res.setHeader('ETag', val);\n  }\n};\n\n/**\r\n * Clear all headers from a response.\r\n *\r\n * @param {object} res\r\n * @private\r\n */\n\nfunction clearHeaders(res) {\n  var headers = getHeaderNames(res);\n  for (var i = 0; i < headers.length; i++) {\n    res.removeHeader(headers[i]);\n  }\n}\n\n/**\r\n * Collapse all leading slashes into a single slash\r\n *\r\n * @param {string} str\r\n * @private\r\n */\nfunction collapseLeadingSlashes(str) {\n  for (var i = 0; i < str.length; i++) {\n    if (str[i] !== '/') {\n      break;\n    }\n  }\n  return i > 1 ? '/' + str.substr(i) : str;\n}\n\n/**\r\n * Determine if path parts contain a dotfile.\r\n *\r\n * @api private\r\n */\n\nfunction containsDotFile(parts) {\n  for (var i = 0; i < parts.length; i++) {\n    var part = parts[i];\n    if (part.length > 1 && part[0] === '.') {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\r\n * Create a Content-Range header.\r\n *\r\n * @param {string} type\r\n * @param {number} size\r\n * @param {array} [range]\r\n */\n\nfunction contentRange(type, size, range) {\n  return type + ' ' + (range ? range.start + '-' + range.end : '*') + '/' + size;\n}\n\n/**\r\n * Create a minimal HTML document.\r\n *\r\n * @param {string} title\r\n * @param {string} body\r\n * @private\r\n */\n\nfunction createHtmlDocument(title, body) {\n  return '<!DOCTYPE html>\\n' + '<html lang=\"en\">\\n' + '<head>\\n' + '<meta charset=\"utf-8\">\\n' + '<title>' + title + '</title>\\n' + '</head>\\n' + '<body>\\n' + '<pre>' + body + '</pre>\\n' + '</body>\\n' + '</html>\\n';\n}\n\n/**\r\n * decodeURIComponent.\r\n *\r\n * Allows V8 to only deoptimize this fn instead of all\r\n * of send().\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\n\nfunction decode(path) {\n  try {\n    return decodeURIComponent(path);\n  } catch (err) {\n    return -1;\n  }\n}\n\n/**\r\n * Get the header names on a respnse.\r\n *\r\n * @param {object} res\r\n * @returns {array[string]}\r\n * @private\r\n */\n\nfunction getHeaderNames(res) {\n  return typeof res.getHeaderNames !== 'function' ? Object.keys(res._headers || {}) : res.getHeaderNames();\n}\n\n/**\r\n * Determine if emitter has listeners of a given type.\r\n *\r\n * The way to do this check is done three different ways in Node.js >= 0.8\r\n * so this consolidates them into a minimal set using instance methods.\r\n *\r\n * @param {EventEmitter} emitter\r\n * @param {string} type\r\n * @returns {boolean}\r\n * @private\r\n */\n\nfunction hasListeners(emitter, type) {\n  var count = typeof emitter.listenerCount !== 'function' ? emitter.listeners(type).length : emitter.listenerCount(type);\n  return count > 0;\n}\n\n/**\r\n * Determine if the response headers have been sent.\r\n *\r\n * @param {object} res\r\n * @returns {boolean}\r\n * @private\r\n */\n\nfunction headersSent(res) {\n  return typeof res.headersSent !== 'boolean' ? Boolean(res._header) : res.headersSent;\n}\n\n/**\r\n * Normalize the index option into an array.\r\n *\r\n * @param {boolean|string|array} val\r\n * @param {string} name\r\n * @private\r\n */\n\nfunction normalizeList(val, name) {\n  var list = [].concat(val || []);\n  for (var i = 0; i < list.length; i++) {\n    if (typeof list[i] !== 'string') {\n      throw new TypeError(name + ' must be array of strings or false');\n    }\n  }\n  return list;\n}\n\n/**\r\n * Parse an HTTP Date into a number.\r\n *\r\n * @param {string} date\r\n * @private\r\n */\n\nfunction parseHttpDate(date) {\n  var timestamp = date && Date.parse(date);\n  return typeof timestamp === 'number' ? timestamp : NaN;\n}\n\n/**\r\n * Parse a HTTP token list.\r\n *\r\n * @param {string} str\r\n * @private\r\n */\n\nfunction parseTokenList(str) {\n  var end = 0;\n  var list = [];\n  var start = 0;\n\n  // gather tokens\n  for (var i = 0, len = str.length; i < len; i++) {\n    switch (str.charCodeAt(i)) {\n      case 0x20:\n        /*   */\n        if (start === end) {\n          start = end = i + 1;\n        }\n        break;\n      case 0x2c:\n        /* , */\n        list.push(str.substring(start, end));\n        start = end = i + 1;\n        break;\n      default:\n        end = i + 1;\n        break;\n    }\n  }\n\n  // final token\n  list.push(str.substring(start, end));\n  return list;\n}\n\n/**\r\n * Set an object of headers on a response.\r\n *\r\n * @param {object} res\r\n * @param {object} headers\r\n * @private\r\n */\n\nfunction setHeaders(res, headers) {\n  var keys = Object.keys(headers);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    res.setHeader(key, headers[key]);\n  }\n}","map":{"version":3,"names":["createError","require","debug","deprecate","destroy","encodeUrl","escapeHtml","etag","fresh","fs","mime","ms","onFinished","parseRange","path","statuses","Stream","util","extname","join","normalize","resolve","sep","BYTES_RANGE_REGEXP","MAX_MAXAGE","UP_PATH_REGEXP","module","exports","send","req","options","SendStream","call","opts","_acceptRanges","acceptRanges","undefined","Boolean","_cacheControl","cacheControl","_etag","_dotfiles","dotfiles","TypeError","_hidden","hidden","_extensions","extensions","normalizeList","_immutable","immutable","_index","index","_lastModified","lastModified","_maxage","maxAge","maxage","Number","isNaN","Math","min","max","_root","root","from","inherits","prototype","function","val","paths","String","error","status","err","hasListeners","emit","expose","res","msg","doc","createHtmlDocument","clearHeaders","headers","setHeaders","statusCode","setHeader","Buffer","byteLength","end","hasTrailingSlash","length","isConditionalGET","isPreconditionFailure","match","getHeader","parseTokenList","every","unmodifiedSince","parseHttpDate","removeContentHeaderFields","getHeaderNames","i","header","substr","removeHeader","notModified","headersAlreadySent","Error","isCachable","onStatError","code","isFresh","isRangeFresh","ifRange","indexOf","redirect","loc","collapseLeadingSlashes","pipe","decode","parts","test","split","containsDotFile","access","sendIndex","sendFile","stat","len","size","ranges","range","offset","start","headersSent","type","bytes","combine","contentRange","prop","method","stream","self","onstat","next","isDirectory","p","finished","createReadStream","onfinished","on","onerror","onend","lookup","charset","charsets","floor","modified","mtime","toUTCString","str","part","title","body","decodeURIComponent","Object","keys","_headers","emitter","count","listenerCount","listeners","_header","name","list","concat","date","timestamp","Date","parse","NaN","charCodeAt","push","substring","key"],"sources":["C:/Users/Admin/Downloads/source_code/node_modules/send/index.js"],"sourcesContent":["/*!\r\n * send\r\n * Copyright(c) 2012 TJ Holowaychuk\r\n * Copyright(c) 2014-2016 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\r\n\r\n'use strict'\r\n\r\n/**\r\n * Module dependencies.\r\n * @private\r\n */\r\n\r\nvar createError = require('http-errors')\r\nvar debug = require('debug')('send')\r\nvar deprecate = require('depd')('send')\r\nvar destroy = require('destroy')\r\nvar encodeUrl = require('encodeurl')\r\nvar escapeHtml = require('escape-html')\r\nvar etag = require('etag')\r\nvar fresh = require('fresh')\r\nvar fs = require('fs')\r\nvar mime = require('mime')\r\nvar ms = require('ms')\r\nvar onFinished = require('on-finished')\r\nvar parseRange = require('range-parser')\r\nvar path = require('path')\r\nvar statuses = require('statuses')\r\nvar Stream = require('stream')\r\nvar util = require('util')\r\n\r\n/**\r\n * Path function references.\r\n * @private\r\n */\r\n\r\nvar extname = path.extname\r\nvar join = path.join\r\nvar normalize = path.normalize\r\nvar resolve = path.resolve\r\nvar sep = path.sep\r\n\r\n/**\r\n * Regular expression for identifying a bytes Range header.\r\n * @private\r\n */\r\n\r\nvar BYTES_RANGE_REGEXP = /^ *bytes=/\r\n\r\n/**\r\n * Maximum value allowed for the max age.\r\n * @private\r\n */\r\n\r\nvar MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000 // 1 year\r\n\r\n/**\r\n * Regular expression to match a path with a directory up component.\r\n * @private\r\n */\r\n\r\nvar UP_PATH_REGEXP = /(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/\r\n\r\n/**\r\n * Module exports.\r\n * @public\r\n */\r\n\r\nmodule.exports = send\r\nmodule.exports.mime = mime\r\n\r\n/**\r\n * Return a `SendStream` for `req` and `path`.\r\n *\r\n * @param {object} req\r\n * @param {string} path\r\n * @param {object} [options]\r\n * @return {SendStream}\r\n * @public\r\n */\r\n\r\nfunction send (req, path, options) {\r\n  return new SendStream(req, path, options)\r\n}\r\n\r\n/**\r\n * Initialize a `SendStream` with the given `path`.\r\n *\r\n * @param {Request} req\r\n * @param {String} path\r\n * @param {object} [options]\r\n * @private\r\n */\r\n\r\nfunction SendStream (req, path, options) {\r\n  Stream.call(this)\r\n\r\n  var opts = options || {}\r\n\r\n  this.options = opts\r\n  this.path = path\r\n  this.req = req\r\n\r\n  this._acceptRanges = opts.acceptRanges !== undefined\r\n    ? Boolean(opts.acceptRanges)\r\n    : true\r\n\r\n  this._cacheControl = opts.cacheControl !== undefined\r\n    ? Boolean(opts.cacheControl)\r\n    : true\r\n\r\n  this._etag = opts.etag !== undefined\r\n    ? Boolean(opts.etag)\r\n    : true\r\n\r\n  this._dotfiles = opts.dotfiles !== undefined\r\n    ? opts.dotfiles\r\n    : 'ignore'\r\n\r\n  if (this._dotfiles !== 'ignore' && this._dotfiles !== 'allow' && this._dotfiles !== 'deny') {\r\n    throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"')\r\n  }\r\n\r\n  this._hidden = Boolean(opts.hidden)\r\n\r\n  if (opts.hidden !== undefined) {\r\n    deprecate('hidden: use dotfiles: \\'' + (this._hidden ? 'allow' : 'ignore') + '\\' instead')\r\n  }\r\n\r\n  // legacy support\r\n  if (opts.dotfiles === undefined) {\r\n    this._dotfiles = undefined\r\n  }\r\n\r\n  this._extensions = opts.extensions !== undefined\r\n    ? normalizeList(opts.extensions, 'extensions option')\r\n    : []\r\n\r\n  this._immutable = opts.immutable !== undefined\r\n    ? Boolean(opts.immutable)\r\n    : false\r\n\r\n  this._index = opts.index !== undefined\r\n    ? normalizeList(opts.index, 'index option')\r\n    : ['index.html']\r\n\r\n  this._lastModified = opts.lastModified !== undefined\r\n    ? Boolean(opts.lastModified)\r\n    : true\r\n\r\n  this._maxage = opts.maxAge || opts.maxage\r\n  this._maxage = typeof this._maxage === 'string'\r\n    ? ms(this._maxage)\r\n    : Number(this._maxage)\r\n  this._maxage = !isNaN(this._maxage)\r\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\r\n    : 0\r\n\r\n  this._root = opts.root\r\n    ? resolve(opts.root)\r\n    : null\r\n\r\n  if (!this._root && opts.from) {\r\n    this.from(opts.from)\r\n  }\r\n}\r\n\r\n/**\r\n * Inherits from `Stream`.\r\n */\r\n\r\nutil.inherits(SendStream, Stream)\r\n\r\n/**\r\n * Enable or disable etag generation.\r\n *\r\n * @param {Boolean} val\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.etag = deprecate.function(function etag (val) {\r\n  this._etag = Boolean(val)\r\n  debug('etag %s', this._etag)\r\n  return this\r\n}, 'send.etag: pass etag as option')\r\n\r\n/**\r\n * Enable or disable \"hidden\" (dot) files.\r\n *\r\n * @param {Boolean} path\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.hidden = deprecate.function(function hidden (val) {\r\n  this._hidden = Boolean(val)\r\n  this._dotfiles = undefined\r\n  debug('hidden %s', this._hidden)\r\n  return this\r\n}, 'send.hidden: use dotfiles option')\r\n\r\n/**\r\n * Set index `paths`, set to a falsy\r\n * value to disable index support.\r\n *\r\n * @param {String|Boolean|Array} paths\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.index = deprecate.function(function index (paths) {\r\n  var index = !paths ? [] : normalizeList(paths, 'paths argument')\r\n  debug('index %o', paths)\r\n  this._index = index\r\n  return this\r\n}, 'send.index: pass index as option')\r\n\r\n/**\r\n * Set root `path`.\r\n *\r\n * @param {String} path\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.root = function root (path) {\r\n  this._root = resolve(String(path))\r\n  debug('root %s', this._root)\r\n  return this\r\n}\r\n\r\nSendStream.prototype.from = deprecate.function(SendStream.prototype.root,\r\n  'send.from: pass root as option')\r\n\r\nSendStream.prototype.root = deprecate.function(SendStream.prototype.root,\r\n  'send.root: pass root as option')\r\n\r\n/**\r\n * Set max-age to `maxAge`.\r\n *\r\n * @param {Number} maxAge\r\n * @return {SendStream}\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.maxage = deprecate.function(function maxage (maxAge) {\r\n  this._maxage = typeof maxAge === 'string'\r\n    ? ms(maxAge)\r\n    : Number(maxAge)\r\n  this._maxage = !isNaN(this._maxage)\r\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\r\n    : 0\r\n  debug('max-age %d', this._maxage)\r\n  return this\r\n}, 'send.maxage: pass maxAge as option')\r\n\r\n/**\r\n * Emit error with `status`.\r\n *\r\n * @param {number} status\r\n * @param {Error} [err]\r\n * @private\r\n */\r\n\r\nSendStream.prototype.error = function error (status, err) {\r\n  // emit if listeners instead of responding\r\n  if (hasListeners(this, 'error')) {\r\n    return this.emit('error', createError(status, err, {\r\n      expose: false\r\n    }))\r\n  }\r\n\r\n  var res = this.res\r\n  var msg = statuses[status] || String(status)\r\n  var doc = createHtmlDocument('Error', escapeHtml(msg))\r\n\r\n  // clear existing headers\r\n  clearHeaders(res)\r\n\r\n  // add error headers\r\n  if (err && err.headers) {\r\n    setHeaders(res, err.headers)\r\n  }\r\n\r\n  // send basic response\r\n  res.statusCode = status\r\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8')\r\n  res.setHeader('Content-Length', Buffer.byteLength(doc))\r\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\")\r\n  res.setHeader('X-Content-Type-Options', 'nosniff')\r\n  res.end(doc)\r\n}\r\n\r\n/**\r\n * Check if the pathname ends with \"/\".\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\r\n\r\nSendStream.prototype.hasTrailingSlash = function hasTrailingSlash () {\r\n  return this.path[this.path.length - 1] === '/'\r\n}\r\n\r\n/**\r\n * Check if this is a conditional GET request.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isConditionalGET = function isConditionalGET () {\r\n  return this.req.headers['if-match'] ||\r\n    this.req.headers['if-unmodified-since'] ||\r\n    this.req.headers['if-none-match'] ||\r\n    this.req.headers['if-modified-since']\r\n}\r\n\r\n/**\r\n * Check if the request preconditions failed.\r\n *\r\n * @return {boolean}\r\n * @private\r\n */\r\n\r\nSendStream.prototype.isPreconditionFailure = function isPreconditionFailure () {\r\n  var req = this.req\r\n  var res = this.res\r\n\r\n  // if-match\r\n  var match = req.headers['if-match']\r\n  if (match) {\r\n    var etag = res.getHeader('ETag')\r\n    return !etag || (match !== '*' && parseTokenList(match).every(function (match) {\r\n      return match !== etag && match !== 'W/' + etag && 'W/' + match !== etag\r\n    }))\r\n  }\r\n\r\n  // if-unmodified-since\r\n  var unmodifiedSince = parseHttpDate(req.headers['if-unmodified-since'])\r\n  if (!isNaN(unmodifiedSince)) {\r\n    var lastModified = parseHttpDate(res.getHeader('Last-Modified'))\r\n    return isNaN(lastModified) || lastModified > unmodifiedSince\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * Strip content-* header fields.\r\n *\r\n * @private\r\n */\r\n\r\nSendStream.prototype.removeContentHeaderFields = function removeContentHeaderFields () {\r\n  var res = this.res\r\n  var headers = getHeaderNames(res)\r\n\r\n  for (var i = 0; i < headers.length; i++) {\r\n    var header = headers[i]\r\n    if (header.substr(0, 8) === 'content-' && header !== 'content-location') {\r\n      res.removeHeader(header)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Respond with 304 not modified.\r\n *\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.notModified = function notModified () {\r\n  var res = this.res\r\n  debug('not modified')\r\n  this.removeContentHeaderFields()\r\n  res.statusCode = 304\r\n  res.end()\r\n}\r\n\r\n/**\r\n * Raise error that headers already sent.\r\n *\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.headersAlreadySent = function headersAlreadySent () {\r\n  var err = new Error('Can\\'t set headers after they are sent.')\r\n  debug('headers already sent')\r\n  this.error(500, err)\r\n}\r\n\r\n/**\r\n * Check if the request is cacheable, aka\r\n * responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isCachable = function isCachable () {\r\n  var statusCode = this.res.statusCode\r\n  return (statusCode >= 200 && statusCode < 300) ||\r\n    statusCode === 304\r\n}\r\n\r\n/**\r\n * Handle stat() error.\r\n *\r\n * @param {Error} error\r\n * @private\r\n */\r\n\r\nSendStream.prototype.onStatError = function onStatError (error) {\r\n  switch (error.code) {\r\n    case 'ENAMETOOLONG':\r\n    case 'ENOENT':\r\n    case 'ENOTDIR':\r\n      this.error(404, error)\r\n      break\r\n    default:\r\n      this.error(500, error)\r\n      break\r\n  }\r\n}\r\n\r\n/**\r\n * Check if the cache is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isFresh = function isFresh () {\r\n  return fresh(this.req.headers, {\r\n    'etag': this.res.getHeader('ETag'),\r\n    'last-modified': this.res.getHeader('Last-Modified')\r\n  })\r\n}\r\n\r\n/**\r\n * Check if the range is fresh.\r\n *\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.isRangeFresh = function isRangeFresh () {\r\n  var ifRange = this.req.headers['if-range']\r\n\r\n  if (!ifRange) {\r\n    return true\r\n  }\r\n\r\n  // if-range as etag\r\n  if (ifRange.indexOf('\"') !== -1) {\r\n    var etag = this.res.getHeader('ETag')\r\n    return Boolean(etag && ifRange.indexOf(etag) !== -1)\r\n  }\r\n\r\n  // if-range as modified date\r\n  var lastModified = this.res.getHeader('Last-Modified')\r\n  return parseHttpDate(lastModified) <= parseHttpDate(ifRange)\r\n}\r\n\r\n/**\r\n * Redirect to path.\r\n *\r\n * @param {string} path\r\n * @private\r\n */\r\n\r\nSendStream.prototype.redirect = function redirect (path) {\r\n  var res = this.res\r\n\r\n  if (hasListeners(this, 'directory')) {\r\n    this.emit('directory', res, path)\r\n    return\r\n  }\r\n\r\n  if (this.hasTrailingSlash()) {\r\n    this.error(403)\r\n    return\r\n  }\r\n\r\n  var loc = encodeUrl(collapseLeadingSlashes(this.path + '/'))\r\n  var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\r\n    escapeHtml(loc) + '</a>')\r\n\r\n  // redirect\r\n  res.statusCode = 301\r\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8')\r\n  res.setHeader('Content-Length', Buffer.byteLength(doc))\r\n  res.setHeader('Content-Security-Policy', \"default-src 'none'\")\r\n  res.setHeader('X-Content-Type-Options', 'nosniff')\r\n  res.setHeader('Location', loc)\r\n  res.end(doc)\r\n}\r\n\r\n/**\r\n * Pipe to `res.\r\n *\r\n * @param {Stream} res\r\n * @return {Stream} res\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.pipe = function pipe (res) {\r\n  // root path\r\n  var root = this._root\r\n\r\n  // references\r\n  this.res = res\r\n\r\n  // decode the path\r\n  var path = decode(this.path)\r\n  if (path === -1) {\r\n    this.error(400)\r\n    return res\r\n  }\r\n\r\n  // null byte(s)\r\n  if (~path.indexOf('\\0')) {\r\n    this.error(400)\r\n    return res\r\n  }\r\n\r\n  var parts\r\n  if (root !== null) {\r\n    // normalize\r\n    if (path) {\r\n      path = normalize('.' + sep + path)\r\n    }\r\n\r\n    // malicious path\r\n    if (UP_PATH_REGEXP.test(path)) {\r\n      debug('malicious path \"%s\"', path)\r\n      this.error(403)\r\n      return res\r\n    }\r\n\r\n    // explode path parts\r\n    parts = path.split(sep)\r\n\r\n    // join / normalize from optional root dir\r\n    path = normalize(join(root, path))\r\n  } else {\r\n    // \"..\" is malicious without \"root\"\r\n    if (UP_PATH_REGEXP.test(path)) {\r\n      debug('malicious path \"%s\"', path)\r\n      this.error(403)\r\n      return res\r\n    }\r\n\r\n    // explode path parts\r\n    parts = normalize(path).split(sep)\r\n\r\n    // resolve the path\r\n    path = resolve(path)\r\n  }\r\n\r\n  // dotfile handling\r\n  if (containsDotFile(parts)) {\r\n    var access = this._dotfiles\r\n\r\n    // legacy support\r\n    if (access === undefined) {\r\n      access = parts[parts.length - 1][0] === '.'\r\n        ? (this._hidden ? 'allow' : 'ignore')\r\n        : 'allow'\r\n    }\r\n\r\n    debug('%s dotfile \"%s\"', access, path)\r\n    switch (access) {\r\n      case 'allow':\r\n        break\r\n      case 'deny':\r\n        this.error(403)\r\n        return res\r\n      case 'ignore':\r\n      default:\r\n        this.error(404)\r\n        return res\r\n    }\r\n  }\r\n\r\n  // index file support\r\n  if (this._index.length && this.hasTrailingSlash()) {\r\n    this.sendIndex(path)\r\n    return res\r\n  }\r\n\r\n  this.sendFile(path)\r\n  return res\r\n}\r\n\r\n/**\r\n * Transfer `path`.\r\n *\r\n * @param {String} path\r\n * @api public\r\n */\r\n\r\nSendStream.prototype.send = function send (path, stat) {\r\n  var len = stat.size\r\n  var options = this.options\r\n  var opts = {}\r\n  var res = this.res\r\n  var req = this.req\r\n  var ranges = req.headers.range\r\n  var offset = options.start || 0\r\n\r\n  if (headersSent(res)) {\r\n    // impossible to send now\r\n    this.headersAlreadySent()\r\n    return\r\n  }\r\n\r\n  debug('pipe \"%s\"', path)\r\n\r\n  // set header fields\r\n  this.setHeader(path, stat)\r\n\r\n  // set content-type\r\n  this.type(path)\r\n\r\n  // conditional GET support\r\n  if (this.isConditionalGET()) {\r\n    if (this.isPreconditionFailure()) {\r\n      this.error(412)\r\n      return\r\n    }\r\n\r\n    if (this.isCachable() && this.isFresh()) {\r\n      this.notModified()\r\n      return\r\n    }\r\n  }\r\n\r\n  // adjust len to start/end options\r\n  len = Math.max(0, len - offset)\r\n  if (options.end !== undefined) {\r\n    var bytes = options.end - offset + 1\r\n    if (len > bytes) len = bytes\r\n  }\r\n\r\n  // Range support\r\n  if (this._acceptRanges && BYTES_RANGE_REGEXP.test(ranges)) {\r\n    // parse\r\n    ranges = parseRange(len, ranges, {\r\n      combine: true\r\n    })\r\n\r\n    // If-Range support\r\n    if (!this.isRangeFresh()) {\r\n      debug('range stale')\r\n      ranges = -2\r\n    }\r\n\r\n    // unsatisfiable\r\n    if (ranges === -1) {\r\n      debug('range unsatisfiable')\r\n\r\n      // Content-Range\r\n      res.setHeader('Content-Range', contentRange('bytes', len))\r\n\r\n      // 416 Requested Range Not Satisfiable\r\n      return this.error(416, {\r\n        headers: { 'Content-Range': res.getHeader('Content-Range') }\r\n      })\r\n    }\r\n\r\n    // valid (syntactically invalid/multiple ranges are treated as a regular response)\r\n    if (ranges !== -2 && ranges.length === 1) {\r\n      debug('range %j', ranges)\r\n\r\n      // Content-Range\r\n      res.statusCode = 206\r\n      res.setHeader('Content-Range', contentRange('bytes', len, ranges[0]))\r\n\r\n      // adjust for requested range\r\n      offset += ranges[0].start\r\n      len = ranges[0].end - ranges[0].start + 1\r\n    }\r\n  }\r\n\r\n  // clone options\r\n  for (var prop in options) {\r\n    opts[prop] = options[prop]\r\n  }\r\n\r\n  // set read options\r\n  opts.start = offset\r\n  opts.end = Math.max(offset, offset + len - 1)\r\n\r\n  // content-length\r\n  res.setHeader('Content-Length', len)\r\n\r\n  // HEAD support\r\n  if (req.method === 'HEAD') {\r\n    res.end()\r\n    return\r\n  }\r\n\r\n  this.stream(path, opts)\r\n}\r\n\r\n/**\r\n * Transfer file for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\nSendStream.prototype.sendFile = function sendFile (path) {\r\n  var i = 0\r\n  var self = this\r\n\r\n  debug('stat \"%s\"', path)\r\n  fs.stat(path, function onstat (err, stat) {\r\n    if (err && err.code === 'ENOENT' && !extname(path) && path[path.length - 1] !== sep) {\r\n      // not found, check extensions\r\n      return next(err)\r\n    }\r\n    if (err) return self.onStatError(err)\r\n    if (stat.isDirectory()) return self.redirect(path)\r\n    self.emit('file', path, stat)\r\n    self.send(path, stat)\r\n  })\r\n\r\n  function next (err) {\r\n    if (self._extensions.length <= i) {\r\n      return err\r\n        ? self.onStatError(err)\r\n        : self.error(404)\r\n    }\r\n\r\n    var p = path + '.' + self._extensions[i++]\r\n\r\n    debug('stat \"%s\"', p)\r\n    fs.stat(p, function (err, stat) {\r\n      if (err) return next(err)\r\n      if (stat.isDirectory()) return next()\r\n      self.emit('file', p, stat)\r\n      self.send(p, stat)\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Transfer index for `path`.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\nSendStream.prototype.sendIndex = function sendIndex (path) {\r\n  var i = -1\r\n  var self = this\r\n\r\n  function next (err) {\r\n    if (++i >= self._index.length) {\r\n      if (err) return self.onStatError(err)\r\n      return self.error(404)\r\n    }\r\n\r\n    var p = join(path, self._index[i])\r\n\r\n    debug('stat \"%s\"', p)\r\n    fs.stat(p, function (err, stat) {\r\n      if (err) return next(err)\r\n      if (stat.isDirectory()) return next()\r\n      self.emit('file', p, stat)\r\n      self.send(p, stat)\r\n    })\r\n  }\r\n\r\n  next()\r\n}\r\n\r\n/**\r\n * Stream `path` to the response.\r\n *\r\n * @param {String} path\r\n * @param {Object} options\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.stream = function stream (path, options) {\r\n  // TODO: this is all lame, refactor meeee\r\n  var finished = false\r\n  var self = this\r\n  var res = this.res\r\n\r\n  // pipe\r\n  var stream = fs.createReadStream(path, options)\r\n  this.emit('stream', stream)\r\n  stream.pipe(res)\r\n\r\n  // response finished, done with the fd\r\n  onFinished(res, function onfinished () {\r\n    finished = true\r\n    destroy(stream)\r\n  })\r\n\r\n  // error handling code-smell\r\n  stream.on('error', function onerror (err) {\r\n    // request already finished\r\n    if (finished) return\r\n\r\n    // clean up stream\r\n    finished = true\r\n    destroy(stream)\r\n\r\n    // error\r\n    self.onStatError(err)\r\n  })\r\n\r\n  // end\r\n  stream.on('end', function onend () {\r\n    self.emit('end')\r\n  })\r\n}\r\n\r\n/**\r\n * Set content-type based on `path`\r\n * if it hasn't been explicitly set.\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.type = function type (path) {\r\n  var res = this.res\r\n\r\n  if (res.getHeader('Content-Type')) return\r\n\r\n  var type = mime.lookup(path)\r\n\r\n  if (!type) {\r\n    debug('no content-type')\r\n    return\r\n  }\r\n\r\n  var charset = mime.charsets.lookup(type)\r\n\r\n  debug('content-type %s', type)\r\n  res.setHeader('Content-Type', type + (charset ? '; charset=' + charset : ''))\r\n}\r\n\r\n/**\r\n * Set response header fields, most\r\n * fields may be pre-defined.\r\n *\r\n * @param {String} path\r\n * @param {Object} stat\r\n * @api private\r\n */\r\n\r\nSendStream.prototype.setHeader = function setHeader (path, stat) {\r\n  var res = this.res\r\n\r\n  this.emit('headers', res, path, stat)\r\n\r\n  if (this._acceptRanges && !res.getHeader('Accept-Ranges')) {\r\n    debug('accept ranges')\r\n    res.setHeader('Accept-Ranges', 'bytes')\r\n  }\r\n\r\n  if (this._cacheControl && !res.getHeader('Cache-Control')) {\r\n    var cacheControl = 'public, max-age=' + Math.floor(this._maxage / 1000)\r\n\r\n    if (this._immutable) {\r\n      cacheControl += ', immutable'\r\n    }\r\n\r\n    debug('cache-control %s', cacheControl)\r\n    res.setHeader('Cache-Control', cacheControl)\r\n  }\r\n\r\n  if (this._lastModified && !res.getHeader('Last-Modified')) {\r\n    var modified = stat.mtime.toUTCString()\r\n    debug('modified %s', modified)\r\n    res.setHeader('Last-Modified', modified)\r\n  }\r\n\r\n  if (this._etag && !res.getHeader('ETag')) {\r\n    var val = etag(stat)\r\n    debug('etag %s', val)\r\n    res.setHeader('ETag', val)\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all headers from a response.\r\n *\r\n * @param {object} res\r\n * @private\r\n */\r\n\r\nfunction clearHeaders (res) {\r\n  var headers = getHeaderNames(res)\r\n\r\n  for (var i = 0; i < headers.length; i++) {\r\n    res.removeHeader(headers[i])\r\n  }\r\n}\r\n\r\n/**\r\n * Collapse all leading slashes into a single slash\r\n *\r\n * @param {string} str\r\n * @private\r\n */\r\nfunction collapseLeadingSlashes (str) {\r\n  for (var i = 0; i < str.length; i++) {\r\n    if (str[i] !== '/') {\r\n      break\r\n    }\r\n  }\r\n\r\n  return i > 1\r\n    ? '/' + str.substr(i)\r\n    : str\r\n}\r\n\r\n/**\r\n * Determine if path parts contain a dotfile.\r\n *\r\n * @api private\r\n */\r\n\r\nfunction containsDotFile (parts) {\r\n  for (var i = 0; i < parts.length; i++) {\r\n    var part = parts[i]\r\n    if (part.length > 1 && part[0] === '.') {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * Create a Content-Range header.\r\n *\r\n * @param {string} type\r\n * @param {number} size\r\n * @param {array} [range]\r\n */\r\n\r\nfunction contentRange (type, size, range) {\r\n  return type + ' ' + (range ? range.start + '-' + range.end : '*') + '/' + size\r\n}\r\n\r\n/**\r\n * Create a minimal HTML document.\r\n *\r\n * @param {string} title\r\n * @param {string} body\r\n * @private\r\n */\r\n\r\nfunction createHtmlDocument (title, body) {\r\n  return '<!DOCTYPE html>\\n' +\r\n    '<html lang=\"en\">\\n' +\r\n    '<head>\\n' +\r\n    '<meta charset=\"utf-8\">\\n' +\r\n    '<title>' + title + '</title>\\n' +\r\n    '</head>\\n' +\r\n    '<body>\\n' +\r\n    '<pre>' + body + '</pre>\\n' +\r\n    '</body>\\n' +\r\n    '</html>\\n'\r\n}\r\n\r\n/**\r\n * decodeURIComponent.\r\n *\r\n * Allows V8 to only deoptimize this fn instead of all\r\n * of send().\r\n *\r\n * @param {String} path\r\n * @api private\r\n */\r\n\r\nfunction decode (path) {\r\n  try {\r\n    return decodeURIComponent(path)\r\n  } catch (err) {\r\n    return -1\r\n  }\r\n}\r\n\r\n/**\r\n * Get the header names on a respnse.\r\n *\r\n * @param {object} res\r\n * @returns {array[string]}\r\n * @private\r\n */\r\n\r\nfunction getHeaderNames (res) {\r\n  return typeof res.getHeaderNames !== 'function'\r\n    ? Object.keys(res._headers || {})\r\n    : res.getHeaderNames()\r\n}\r\n\r\n/**\r\n * Determine if emitter has listeners of a given type.\r\n *\r\n * The way to do this check is done three different ways in Node.js >= 0.8\r\n * so this consolidates them into a minimal set using instance methods.\r\n *\r\n * @param {EventEmitter} emitter\r\n * @param {string} type\r\n * @returns {boolean}\r\n * @private\r\n */\r\n\r\nfunction hasListeners (emitter, type) {\r\n  var count = typeof emitter.listenerCount !== 'function'\r\n    ? emitter.listeners(type).length\r\n    : emitter.listenerCount(type)\r\n\r\n  return count > 0\r\n}\r\n\r\n/**\r\n * Determine if the response headers have been sent.\r\n *\r\n * @param {object} res\r\n * @returns {boolean}\r\n * @private\r\n */\r\n\r\nfunction headersSent (res) {\r\n  return typeof res.headersSent !== 'boolean'\r\n    ? Boolean(res._header)\r\n    : res.headersSent\r\n}\r\n\r\n/**\r\n * Normalize the index option into an array.\r\n *\r\n * @param {boolean|string|array} val\r\n * @param {string} name\r\n * @private\r\n */\r\n\r\nfunction normalizeList (val, name) {\r\n  var list = [].concat(val || [])\r\n\r\n  for (var i = 0; i < list.length; i++) {\r\n    if (typeof list[i] !== 'string') {\r\n      throw new TypeError(name + ' must be array of strings or false')\r\n    }\r\n  }\r\n\r\n  return list\r\n}\r\n\r\n/**\r\n * Parse an HTTP Date into a number.\r\n *\r\n * @param {string} date\r\n * @private\r\n */\r\n\r\nfunction parseHttpDate (date) {\r\n  var timestamp = date && Date.parse(date)\r\n\r\n  return typeof timestamp === 'number'\r\n    ? timestamp\r\n    : NaN\r\n}\r\n\r\n/**\r\n * Parse a HTTP token list.\r\n *\r\n * @param {string} str\r\n * @private\r\n */\r\n\r\nfunction parseTokenList (str) {\r\n  var end = 0\r\n  var list = []\r\n  var start = 0\r\n\r\n  // gather tokens\r\n  for (var i = 0, len = str.length; i < len; i++) {\r\n    switch (str.charCodeAt(i)) {\r\n      case 0x20: /*   */\r\n        if (start === end) {\r\n          start = end = i + 1\r\n        }\r\n        break\r\n      case 0x2c: /* , */\r\n        list.push(str.substring(start, end))\r\n        start = end = i + 1\r\n        break\r\n      default:\r\n        end = i + 1\r\n        break\r\n    }\r\n  }\r\n\r\n  // final token\r\n  list.push(str.substring(start, end))\r\n\r\n  return list\r\n}\r\n\r\n/**\r\n * Set an object of headers on a response.\r\n *\r\n * @param {object} res\r\n * @param {object} headers\r\n * @private\r\n */\r\n\r\nfunction setHeaders (res, headers) {\r\n  var keys = Object.keys(headers)\r\n\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    res.setHeader(key, headers[key])\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}