{"ast":null,"code":"var express = require(\"express\");\nconst {\n  existsSync\n} = require(\"fs\");\nvar app = express();\napp.use(express.static(\"public\"));\napp.use(express.json());\nvar server = require(\"http\").Server(app);\napp.set(\"view engine\", \"ejs\");\napp.set(\"views\", \"./view\");\nserver.listen(process.env.PORT || 3000);\napp.get(\"/\", function (req, res) {\n  res.render(\"trangchu\");\n});\nvar io = require(\"socket.io\")(server);\nvar usersArray = [];\nio.on(\"connection\", function (socket) {\n  console.log(socket.id);\n  socket.on(\"disconnect\", function () {\n    console.log(socket.id + \" Đã thoát\");\n  });\n  socket.on(\"client-send-useName\", function (data) {\n    if (!checkExsitUser(data.name)) {\n      usersArray.push(data); //data gom 2; name va marker\n      socket.emit(\"client-dang-ki-thanh-cong\", usersArray);\n      io.sockets.emit(\"sever-send-data\", data);\n      console.log(\"dang ki thanh cong \" + data.name);\n      socket.name = data.name;\n    } else {\n      socket.emit(\"client-dang-ki-that-bai\");\n      console.log(\"dang ki that bai ten \" + data.name);\n    }\n    console.log(\"So client: \" + usersArray.length);\n  });\n  socket.on(\"client-send-location-data\", function (data) {\n    console.log(data.name + \" vua gui trang thai \" + data.stt);\n    var index = indexOf(usersArray, data.name);\n    if (index >= 0) {\n      usersArray[index] = data;\n      io.sockets.emit(\"sever-send-data\", data);\n    }\n  });\n  socket.on(\"disconnect\", function () {\n    console.log(socket.name + \" da thoat!\");\n    var index = indexOf(usersArray, socket.name);\n    usersArray.splice(index, 1);\n    socket.broadcast.emit(\"close\", socket.name);\n    //soket kh con\n  });\n\n  socket.on(\"close\", function () {\n    console.log(socket.name + \" da thoat!\");\n    var index = indexOf(usersArray, socket.name);\n    usersArray.splice(index, 1);\n    socket.broadcast.emit(\"close\", socket.name);\n  });\n});\nfunction checkExsitUser(data) {\n  for (var i = 0; i < usersArray.length; i++) {\n    if (usersArray[i].name == data) return true;\n  }\n  return false;\n}\nfunction indexOf(usersArray, name) {\n  for (var i = 0; i < usersArray.length; i++) {\n    if (usersArray[i].name == name) return i;\n  }\n  return -1;\n}","map":{"version":3,"names":["express","require","existsSync","app","use","static","json","server","Server","set","listen","process","env","PORT","get","req","res","render","io","usersArray","on","socket","console","log","id","data","checkExsitUser","name","push","emit","sockets","length","stt","index","indexOf","splice","broadcast","i"],"sources":["C:/Users/Admin/Downloads/source_code/src/index.js"],"sourcesContent":["var express = require(\"express\");\r\nconst { existsSync } = require(\"fs\");\r\nvar app = express();\r\napp.use(express.static(\"public\"));\r\napp.use(express.json());\r\nvar server = require(\"http\").Server(app);\r\n\r\napp.set(\"view engine\", \"ejs\");\r\napp.set(\"views\", \"./view\");\r\nserver.listen(process.env.PORT || 3000);\r\napp.get(\"/\", function (req, res) {\r\n  res.render(\"trangchu\");\r\n});\r\nvar io = require(\"socket.io\")(server);\r\nvar usersArray = [];\r\nio.on(\"connection\", function (socket) {\r\n  console.log(socket.id);\r\n  socket.on(\"disconnect\", function () {\r\n    console.log(socket.id + \" Đã thoát\");\r\n  });\r\n  socket.on(\"client-send-useName\", function (data) {\r\n    if (!checkExsitUser(data.name)) {\r\n      usersArray.push(data); //data gom 2; name va marker\r\n      socket.emit(\"client-dang-ki-thanh-cong\", usersArray);\r\n      io.sockets.emit(\"sever-send-data\", data);\r\n      console.log(\"dang ki thanh cong \" + data.name);\r\n      socket.name = data.name;\r\n    } else {\r\n      socket.emit(\"client-dang-ki-that-bai\");\r\n      console.log(\"dang ki that bai ten \" + data.name);\r\n    }\r\n    console.log(\"So client: \" + usersArray.length);\r\n  });\r\n  socket.on(\"client-send-location-data\", function (data) {\r\n    console.log(data.name + \" vua gui trang thai \" + data.stt);\r\n    var index = indexOf(usersArray, data.name);\r\n    if (index >= 0) {\r\n      usersArray[index] = data;\r\n      io.sockets.emit(\"sever-send-data\", data);\r\n    }\r\n  });\r\n  socket.on(\"disconnect\", function () {\r\n    console.log(socket.name + \" da thoat!\");\r\n    var index = indexOf(usersArray, socket.name);\r\n    usersArray.splice(index, 1);\r\n    socket.broadcast.emit(\"close\", socket.name);\r\n    //soket kh con\r\n  });\r\n  socket.on(\"close\", function () {\r\n    console.log(socket.name + \" da thoat!\");\r\n    var index = indexOf(usersArray, socket.name);\r\n    usersArray.splice(index, 1);\r\n    socket.broadcast.emit(\"close\", socket.name);\r\n  });\r\n});\r\nfunction checkExsitUser(data) {\r\n  for (var i = 0; i < usersArray.length; i++) {\r\n    if (usersArray[i].name == data) return true;\r\n  }\r\n  return false;\r\n}\r\nfunction indexOf(usersArray, name) {\r\n  for (var i = 0; i < usersArray.length; i++) {\r\n    if (usersArray[i].name == name) return i;\r\n  }\r\n  return -1;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}